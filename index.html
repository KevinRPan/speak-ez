<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f0f0f">
    <title>Speak Sharp</title>
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #242424;
            --bg-card: #1e1e1e;
            --text-primary: #f5f5f5;
            --text-secondary: #a0a0a0;
            --text-muted: #666;
            --accent: #ff9500;
            --accent-light: #ffb347;
            --accent-dim: rgba(255, 149, 0, 0.15);
            --accent-glow: rgba(255, 149, 0, 0.4);
            --success: #58cc02;
            --success-dim: rgba(88, 204, 2, 0.15);
            --success-glow: rgba(88, 204, 2, 0.3);
            --warning: #ff9500;
            --danger: #ff4b4b;
            --purple: #a560e8;
            --purple-dim: rgba(165, 96, 232, 0.15);
            --blue: #1cb0f6;
            --blue-dim: rgba(28, 176, 246, 0.15);
            --border: rgba(255,255,255,0.08);
            --border-light: rgba(255,255,255,0.15);
            --radius: 16px;
            --radius-sm: 12px;
            --radius-xs: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            line-height: 1.5;
            overflow-x: hidden;
        }

        .app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header */
        .header {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: rgba(15,15,15,0.95);
            backdrop-filter: blur(20px);
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .streak-display {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 800;
            color: var(--accent);
        }

        .streak-display .fire {
            font-size: 20px;
            animation: flicker 0.5s infinite alternate;
        }

        @keyframes flicker {
            from { transform: scale(1) rotate(-2deg); }
            to { transform: scale(1.1) rotate(2deg); }
        }

        .xp-display {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--accent);
            font-weight: 700;
        }

        .xp-icon {
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--bg-primary);
            font-weight: 900;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .level-badge {
            background: linear-gradient(135deg, var(--purple), #7c3aed);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 800;
            color: white;
        }

        .settings-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: 20px;
            padding-bottom: 100px;
            overflow-y: auto;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Daily Goal Ring */
        .daily-goal-section {
            display: flex;
            align-items: center;
            gap: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .goal-ring {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .goal-ring svg {
            transform: rotate(-90deg);
        }

        .goal-ring-bg {
            fill: none;
            stroke: var(--bg-tertiary);
            stroke-width: 8;
        }

        .goal-ring-progress {
            fill: none;
            stroke: var(--success);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .goal-ring-text {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 800;
        }

        .goal-ring-value {
            font-size: 20px;
            color: var(--success);
        }

        .goal-ring-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .goal-info {
            flex: 1;
        }

        .goal-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .goal-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Week Progress Bar */
        .week-progress {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px 20px;
            margin-bottom: 20px;
        }

        .week-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .week-label {
            font-weight: 700;
            font-size: 14px;
        }

        .week-phase {
            font-size: 12px;
            color: var(--purple);
            font-weight: 700;
        }

        .week-bar {
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .week-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #7ac70c);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .week-days {
            display: flex;
            justify-content: space-between;
        }

        .week-day {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            background: var(--bg-tertiary);
            color: var(--text-muted);
        }

        .week-day.completed {
            background: var(--success);
            color: var(--bg-primary);
        }

        .week-day.today {
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        /* Prep Reminder */
        .prep-reminder {
            background: linear-gradient(135deg, var(--accent-dim), transparent);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .prep-icon {
            font-size: 24px;
        }

        .prep-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .prep-text strong {
            color: var(--accent);
        }

        /* Exercise Cards */
        .exercises-section {
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 800;
        }

        .section-xp {
            font-size: 13px;
            color: var(--accent);
            font-weight: 700;
        }

        .exercise-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .exercise-card:hover {
            border-color: var(--border-light);
            transform: translateY(-2px);
        }

        .exercise-card.completed {
            border-color: var(--success);
            background: var(--success-dim);
        }

        .exercise-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .exercise-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .exercise-icon.warmup {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
        }

        .exercise-icon.core {
            background: linear-gradient(135deg, var(--blue), #0099dd);
        }

        .exercise-icon.reflection {
            background: linear-gradient(135deg, var(--purple), #8b5cf6);
        }

        .exercise-icon.challenge {
            background: linear-gradient(135deg, var(--accent), #ff7700);
        }

        .exercise-content {
            flex: 1;
        }

        .exercise-type {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            font-weight: 700;
            margin-bottom: 2px;
        }

        .exercise-name {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .exercise-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .exercise-xp {
            color: var(--accent);
            font-weight: 700;
        }

        .exercise-check {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            flex-shrink: 0;
        }

        .exercise-card.completed .exercise-check {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Achievements Banner */
        .achievement-banner {
            background: linear-gradient(135deg, var(--purple-dim), var(--blue-dim));
            border: 1px solid rgba(165, 96, 232, 0.3);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .achievement-icon {
            font-size: 32px;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-title {
            font-weight: 800;
            font-size: 14px;
        }

        .achievement-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .achievement-arrow {
            color: var(--text-muted);
        }

        /* Practice Screen */
        .practice-screen {
            padding-bottom: 40px;
        }

        .practice-header {
            text-align: center;
            margin-bottom: 24px;
            position: relative;
        }

        .back-btn {
            position: absolute;
            top: 0;
            left: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            border-radius: var(--radius-xs);
        }

        .practice-xp-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--accent-dim);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 12px;
        }

        .practice-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 4px;
        }

        .practice-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Prompt Card */
        .prompt-card {
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
            border: 2px solid var(--border-light);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            position: relative;
        }

        .prompt-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .prompt-text {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.5;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .prompt-actions {
            display: flex;
            gap: 8px;
        }

        .prompt-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 14px;
            border-radius: var(--radius-xs);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .prompt-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Framework Card */
        .framework-card {
            background: var(--blue-dim);
            border: 1px solid rgba(28, 176, 246, 0.3);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 20px;
        }

        .framework-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .framework-icon {
            font-size: 16px;
        }

        .framework-label {
            font-size: 11px;
            color: var(--blue);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .framework-name {
            font-weight: 800;
            margin-bottom: 4px;
        }

        .framework-structure {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Timer & Recording */
        .recording-section {
            text-align: center;
            margin-bottom: 24px;
        }

        .timer-display {
            font-size: 56px;
            font-weight: 900;
            color: var(--text-primary);
            letter-spacing: -2px;
            margin-bottom: 8px;
        }

        .timer-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .record-btn {
            width: 88px;
            height: 88px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, var(--success), #4caf50);
            box-shadow: 0 6px 24px var(--success-glow);
            margin: 0 auto 16px;
        }

        .record-btn:hover {
            transform: scale(1.05);
        }

        .record-btn.recording {
            background: linear-gradient(135deg, var(--danger), #e53935);
            animation: pulse 1.5s infinite;
            box-shadow: 0 6px 24px rgba(255, 75, 75, 0.4);
        }

        .record-btn svg {
            width: 36px;
            height: 36px;
            fill: white;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .record-hint {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Transcription */
        .transcription-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }

        .transcription-section.visible {
            display: block;
        }

        .transcription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .transcription-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
        }

        .transcription-status {
            font-size: 12px;
            color: var(--blue);
            font-weight: 600;
        }

        .transcription-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
            max-height: 120px;
            overflow-y: auto;
        }

        /* AI Feedback */
        .ai-feedback-section {
            background: linear-gradient(135deg, var(--purple-dim), var(--blue-dim));
            border: 1px solid rgba(165, 96, 232, 0.3);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .ai-feedback-section.visible {
            display: block;
        }

        .ai-feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .ai-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--purple), var(--blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .ai-title {
            font-weight: 800;
            font-size: 16px;
        }

        .ai-loading {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 0;
        }

        .ai-loading-dots {
            display: flex;
            gap: 4px;
        }

        .ai-loading-dot {
            width: 8px;
            height: 8px;
            background: var(--purple);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .ai-loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .ai-feedback-content {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .ai-feedback-content h4 {
            color: var(--accent);
            font-size: 14px;
            margin: 16px 0 8px;
            font-weight: 800;
        }

        .ai-feedback-content h4:first-child {
            margin-top: 0;
        }

        .ai-feedback-content ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .ai-feedback-content li {
            margin-bottom: 4px;
            color: var(--text-secondary);
        }

        .ai-score {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .ai-score-item {
            flex: 1;
            background: rgba(0,0,0,0.2);
            border-radius: var(--radius-xs);
            padding: 12px;
            text-align: center;
        }

        .ai-score-value {
            font-size: 24px;
            font-weight: 900;
            color: var(--success);
        }

        .ai-score-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        /* Playback */
        .playback-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }

        .playback-section.has-recording {
            display: block;
        }

        .playback-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .play-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--accent);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .play-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .waveform {
            flex: 1;
            height: 44px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 2px;
        }

        .waveform-bar {
            width: 3px;
            background: var(--accent);
            border-radius: 2px;
        }

        .playback-time {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 700;
            min-width: 48px;
            text-align: right;
        }

        /* Filler Counter */
        .filler-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 20px;
        }

        .filler-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .filler-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
        }

        .filler-total {
            font-size: 14px;
            color: var(--warning);
            font-weight: 700;
        }

        .filler-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .filler-btn {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 12px 8px;
            border-radius: var(--radius-xs);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.15s;
        }

        .filler-btn:active {
            transform: scale(0.95);
            background: var(--warning);
            border-color: var(--warning);
            color: var(--bg-primary);
        }

        .filler-count {
            font-size: 18px;
            font-weight: 900;
        }

        /* Self Rating */
        .rating-section {
            margin-bottom: 20px;
        }

        .rating-group {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 12px;
        }

        .rating-label {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .rating-buttons {
            display: flex;
            gap: 8px;
        }

        .rating-btn {
            flex: 1;
            padding: 14px 8px;
            border: 2px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border-radius: var(--radius-xs);
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rating-btn:hover {
            border-color: var(--border-light);
        }

        .rating-btn.selected {
            border-color: var(--success);
            background: var(--success-dim);
            color: var(--success);
        }

        /* Notes */
        .notes-section {
            margin-bottom: 24px;
        }

        .notes-label {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .notes-textarea {
            width: 100%;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 15px;
            resize: none;
            min-height: 80px;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Complete Button */
        .complete-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--success), #4caf50);
            border: none;
            border-radius: var(--radius);
            color: white;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px var(--success-glow);
        }

        .complete-btn:hover {
            transform: translateY(-2px);
        }

        .complete-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* XP Popup */
        .xp-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--bg-secondary);
            border: 2px solid var(--accent);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            z-index: 300;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
        }

        .xp-popup.visible {
            transform: translate(-50%, -50%) scale(1);
        }

        .xp-popup-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .xp-popup-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 8px;
        }

        .xp-popup-xp {
            font-size: 48px;
            font-weight: 900;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .xp-popup-label {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .xp-popup-btn {
            background: var(--accent);
            border: none;
            color: var(--bg-primary);
            padding: 14px 32px;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
        }

        .xp-popup-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 299;
            display: none;
        }

        .xp-popup-overlay.visible {
            display: block;
        }

        /* Progress Screen */
        .progress-header {
            margin-bottom: 24px;
        }

        .progress-title {
            font-size: 28px;
            font-weight: 900;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 4px;
        }

        .stat-value.xp {
            color: var(--accent);
        }

        .stat-value.streak {
            color: var(--danger);
        }

        .stat-value.sessions {
            color: var(--blue);
        }

        .stat-value.level {
            color: var(--purple);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Weekly Chart */
        .chart-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 16px;
        }

        .chart-bars {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 100px;
            gap: 8px;
            margin-bottom: 12px;
        }

        .chart-bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .chart-bar {
            width: 100%;
            max-width: 28px;
            background: var(--bg-tertiary);
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }

        .chart-bar.filled {
            background: linear-gradient(180deg, var(--success), #4caf50);
        }

        .chart-day {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 700;
        }

        /* Achievements */
        .achievements-section {
            margin-bottom: 24px;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .achievement-item {
            aspect-ratio: 1;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .achievement-item.unlocked {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .achievement-item.locked {
            opacity: 0.4;
        }

        .achievement-emoji {
            font-size: 28px;
        }

        .achievement-name {
            font-size: 9px;
            color: var(--text-muted);
            text-align: center;
            font-weight: 700;
        }

        /* Milestones */
        .milestones-section {
            margin-bottom: 24px;
        }

        .milestone-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .milestone-card.achieved {
            border-color: var(--success);
            background: var(--success-dim);
        }

        .milestone-check {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .milestone-card.achieved .milestone-check {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .milestone-content {
            flex: 1;
        }

        .milestone-week {
            font-size: 12px;
            color: var(--purple);
            font-weight: 800;
            margin-bottom: 2px;
        }

        .milestone-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Curriculum */
        .curriculum-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .curriculum-title {
            font-size: 28px;
            font-weight: 900;
        }

        .phase-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .phase-card.current {
            border-color: var(--accent);
        }

        .phase-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .phase-header-left {
            flex: 1;
        }

        .phase-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .phase-badge.phase1 {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .phase-badge.phase2 {
            background: var(--blue-dim);
            color: var(--blue);
        }

        .phase-badge.phase3 {
            background: var(--purple-dim);
            color: var(--purple);
        }

        .phase-name {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .phase-weeks {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .phase-toggle {
            color: var(--text-muted);
            transition: transform 0.2s;
            font-size: 20px;
        }

        .phase-card.expanded .phase-toggle {
            transform: rotate(180deg);
        }

        .phase-content {
            display: none;
            padding: 0 20px 20px;
            border-top: 1px solid var(--border);
        }

        .phase-card.expanded .phase-content {
            display: block;
        }

        .week-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .week-item:last-child {
            border-bottom: none;
        }

        .week-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .week-item.completed .week-status {
            background: var(--success);
            border-color: var(--success);
            color: white;
            font-size: 12px;
        }

        .week-item.current .week-status {
            border-color: var(--accent);
            background: var(--accent);
        }

        .week-info {
            flex: 1;
        }

        .week-number {
            font-weight: 800;
            margin-bottom: 4px;
        }

        .week-focus {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Library */
        .library-header {
            margin-bottom: 20px;
        }

        .library-title {
            font-size: 28px;
            font-weight: 900;
        }

        .library-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .library-tab {
            padding: 10px 18px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 24px;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .library-tab:hover {
            border-color: var(--border-light);
        }

        .library-tab.active {
            background: var(--accent-dim);
            border-color: var(--accent);
            color: var(--accent);
        }

        .library-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .library-item:hover {
            border-color: var(--border-light);
        }

        .library-item-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .library-item-icon.framework {
            background: var(--blue-dim);
        }

        .library-item-icon.warmup {
            background: rgba(255, 107, 107, 0.15);
        }

        .library-item-icon.technique {
            background: var(--purple-dim);
        }

        .library-item-content {
            flex: 1;
        }

        .library-item-title {
            font-weight: 800;
            margin-bottom: 2px;
        }

        .library-item-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 200;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius) var(--radius) 0 0;
            width: 100%;
            max-width: 480px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 24px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 900;
        }

        .modal-close {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .modal-body {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .modal-body h3 {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 800;
            margin: 20px 0 10px;
        }

        .modal-body h3:first-child {
            margin-top: 0;
        }

        .modal-body p {
            margin-bottom: 12px;
        }

        .modal-body ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .modal-body li {
            margin-bottom: 6px;
        }

        /* Settings Modal */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .settings-item-label {
            font-weight: 700;
        }

        .settings-item-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .settings-btn {
            background: var(--accent-dim);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 8px 16px;
            border-radius: var(--radius-xs);
            font-weight: 700;
            cursor: pointer;
        }

        .toggle-switch {
            width: 48px;
            height: 28px;
            background: var(--bg-secondary);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch.active {
            background: var(--success);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.2s;
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        /* Navigation */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15,15,15,0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            padding: 8px 0;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            z-index: 100;
        }

        .nav-inner {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-item:hover {
            color: var(--text-secondary);
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
        }

        .nav-item span {
            font-size: 11px;
            font-weight: 700;
        }

        /* Intro Screen */
        .intro-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 24px;
            text-align: center;
            background: linear-gradient(180deg, var(--bg-primary), #1a1510);
        }

        .intro-icon {
            font-size: 80px;
            margin-bottom: 24px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .intro-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-tagline {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 48px;
            line-height: 1.6;
        }

        .intro-btn {
            background: linear-gradient(135deg, var(--success), #4caf50);
            border: none;
            color: white;
            padding: 18px 40px;
            border-radius: var(--radius);
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 20px var(--success-glow);
        }

        .intro-btn:hover {
            transform: translateY(-2px);
        }

        .intro-features {
            margin-top: 48px;
            display: flex;
            justify-content: center;
            gap: 32px;
        }

        .intro-feature {
            text-align: center;
        }

        .intro-feature-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .intro-feature-text {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- Intro Screen -->
        <div class="intro-screen" id="introScreen">
            <div class="intro-icon">ðŸŽ¯</div>
            <h1 class="intro-title">Speak Sharp</h1>
            <p class="intro-tagline">12 weeks to speak with confidence,<br>clarity, and presence.</p>
            <button class="intro-btn" onclick="startApp()">Start Training</button>
            <div class="intro-features">
                <div class="intro-feature">
                    <div class="intro-feature-icon">ðŸ”¥</div>
                    <div class="intro-feature-text">Daily<br>Streaks</div>
                </div>
                <div class="intro-feature">
                    <div class="intro-feature-icon">ðŸ¤–</div>
                    <div class="intro-feature-text">AI<br>Feedback</div>
                </div>
                <div class="intro-feature">
                    <div class="intro-feature-icon">ðŸ“Š</div>
                    <div class="intro-feature-text">Track<br>Progress</div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp" style="display: none;">
            <header class="header">
                <div class="header-left">
                    <div class="streak-display">
                        <span class="fire">ðŸ”¥</span>
                        <span id="streakCount">0</span>
                    </div>
                    <div class="xp-display">
                        <div class="xp-icon">âš¡</div>
                        <span id="xpCount">0</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="level-badge" id="levelBadge">Lv. 1</div>
                    <button class="settings-btn" onclick="openSettings()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
                        </svg>
                    </button>
                </div>
            </header>

            <main class="main">
                <!-- Today Screen -->
                <div class="screen active" id="todayScreen">
                    <div class="daily-goal-section">
                        <div class="goal-ring">
                            <svg width="80" height="80" viewBox="0 0 80 80">
                                <circle class="goal-ring-bg" cx="40" cy="40" r="34"/>
                                <circle class="goal-ring-progress" cx="40" cy="40" r="34" 
                                    stroke-dasharray="213.6" 
                                    stroke-dashoffset="213.6" 
                                    id="goalRingProgress"/>
                            </svg>
                            <div class="goal-ring-text">
                                <span class="goal-ring-value" id="goalValue">0/3</span>
                                <span class="goal-ring-label">Today</span>
                            </div>
                        </div>
                        <div class="goal-info">
                            <div class="goal-title" id="goalTitle">Complete 3 exercises</div>
                            <div class="goal-subtitle" id="goalSubtitle">+150 XP bonus for finishing all</div>
                        </div>
                    </div>

                    <div class="week-progress">
                        <div class="week-progress-header">
                            <span class="week-label" id="weekLabel">Week 1</span>
                            <span class="week-phase" id="weekPhase">Interview Ready</span>
                        </div>
                        <div class="week-bar">
                            <div class="week-bar-fill" id="weekBarFill" style="width: 0%"></div>
                        </div>
                        <div class="week-days" id="weekDays"></div>
                    </div>

                    <div class="prep-reminder">
                        <span class="prep-icon">ðŸ’¡</span>
                        <div class="prep-text">
                            Before every speaking moment: <strong>Audience</strong> â†’ <strong>Material</strong> â†’ <strong>Outcome</strong>
                        </div>
                    </div>

                    <div class="exercises-section">
                        <div class="section-header">
                            <span class="section-title">Today's Practice</span>
                            <span class="section-xp">+200 XP</span>
                        </div>
                        <div id="todayExercises"></div>
                    </div>

                    <div class="achievement-banner" id="achievementBanner" onclick="showAchievements()" style="display: none;">
                        <span class="achievement-icon" id="achievementIcon">ðŸ†</span>
                        <div class="achievement-info">
                            <div class="achievement-title" id="achievementTitle">New Achievement!</div>
                            <div class="achievement-desc" id="achievementDesc">You unlocked something</div>
                        </div>
                        <span class="achievement-arrow">â†’</span>
                    </div>
                </div>

                <!-- Practice Screen -->
                <div class="screen practice-screen" id="practiceScreen">
                    <div class="practice-header">
                        <button class="back-btn" onclick="exitPractice()">â† Back</button>
                        <div class="practice-xp-badge">+<span id="practiceXp">50</span> XP</div>
                        <h1 class="practice-title" id="practiceTitle">Structure Drills</h1>
                        <p class="practice-subtitle" id="practiceSubtitle">Think fast, speak clearly</p>
                    </div>

                    <div class="prompt-card" id="promptCard">
                        <div class="prompt-label">Your Prompt</div>
                        <p class="prompt-text" id="promptText">Loading...</p>
                        <div class="prompt-actions">
                            <button class="prompt-btn" onclick="newPrompt()">ðŸ”„ New Prompt</button>
                            <button class="prompt-btn" onclick="showFrameworkHelp()">ðŸ’¡ Framework Help</button>
                        </div>
                    </div>

                    <div class="framework-card" id="frameworkCard">
                        <div class="framework-header">
                            <span class="framework-icon">ðŸ“</span>
                            <span class="framework-label">Suggested Framework</span>
                        </div>
                        <div class="framework-name" id="frameworkName">What? So What? Now What?</div>
                        <div class="framework-structure" id="frameworkStructure">State the fact â†’ Why it matters â†’ Action</div>
                    </div>

                    <div class="recording-section">
                        <div class="timer-display" id="timerDisplay">0:00</div>
                        <div class="timer-label">Response Time</div>
                        <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
                            <svg viewBox="0 0 24 24" id="recordIcon"><circle cx="12" cy="12" r="6"/></svg>
                        </button>
                        <p class="record-hint" id="recordHint">Tap to start recording</p>
                    </div>

                    <div class="transcription-section" id="transcriptionSection">
                        <div class="transcription-header">
                            <span class="transcription-label">Live Transcription</span>
                            <span class="transcription-status" id="transcriptionStatus">Listening...</span>
                        </div>
                        <div class="transcription-text" id="transcriptionText"></div>
                    </div>

                    <div class="playback-section" id="playbackSection">
                        <div class="playback-controls">
                            <button class="play-btn" id="playBtn" onclick="togglePlayback()">
                                <svg viewBox="0 0 24 24" id="playIcon"><polygon points="5,3 19,12 5,21"/></svg>
                            </button>
                            <div class="waveform" id="waveform"></div>
                            <span class="playback-time" id="playbackTime">0:00</span>
                        </div>
                    </div>

                    <div class="ai-feedback-section" id="aiFeedbackSection">
                        <div class="ai-feedback-header">
                            <div class="ai-icon">ðŸ¤–</div>
                            <span class="ai-title">AI Coach Feedback</span>
                        </div>
                        <div class="ai-loading" id="aiLoading">
                            <div class="ai-loading-dots">
                                <div class="ai-loading-dot"></div>
                                <div class="ai-loading-dot"></div>
                                <div class="ai-loading-dot"></div>
                            </div>
                            <span>Analyzing your response...</span>
                        </div>
                        <div class="ai-score" id="aiScore" style="display: none;">
                            <div class="ai-score-item">
                                <div class="ai-score-value" id="aiStructureScore">-</div>
                                <div class="ai-score-label">Structure</div>
                            </div>
                            <div class="ai-score-item">
                                <div class="ai-score-value" id="aiClarityScore">-</div>
                                <div class="ai-score-label">Clarity</div>
                            </div>
                            <div class="ai-score-item">
                                <div class="ai-score-value" id="aiConcisenessScore">-</div>
                                <div class="ai-score-label">Concise</div>
                            </div>
                        </div>
                        <div class="ai-feedback-content" id="aiFeedbackContent"></div>
                    </div>

                    <div class="filler-section">
                        <div class="filler-header">
                            <span class="filler-label">Filler Word Counter</span>
                            <span class="filler-total">Total: <span id="fillerTotal">0</span></span>
                        </div>
                        <div class="filler-buttons">
                            <button class="filler-btn" onclick="countFiller('um')">
                                Um
                                <span class="filler-count" id="umCount">0</span>
                            </button>
                            <button class="filler-btn" onclick="countFiller('uh')">
                                Uh
                                <span class="filler-count" id="uhCount">0</span>
                            </button>
                            <button class="filler-btn" onclick="countFiller('like')">
                                Like
                                <span class="filler-count" id="likeCount">0</span>
                            </button>
                            <button class="filler-btn" onclick="countFiller('so')">
                                So
                                <span class="filler-count" id="soCount">0</span>
                            </button>
                        </div>
                    </div>

                    <div class="rating-section">
                        <div class="rating-group">
                            <div class="rating-label">Structure Clarity</div>
                            <div class="rating-buttons" data-rating="structure">
                                <button class="rating-btn" data-value="1">1</button>
                                <button class="rating-btn" data-value="2">2</button>
                                <button class="rating-btn" data-value="3">3</button>
                                <button class="rating-btn" data-value="4">4</button>
                                <button class="rating-btn" data-value="5">5</button>
                            </div>
                        </div>
                        <div class="rating-group">
                            <div class="rating-label">Confidence Felt</div>
                            <div class="rating-buttons" data-rating="confidence">
                                <button class="rating-btn" data-value="1">1</button>
                                <button class="rating-btn" data-value="2">2</button>
                                <button class="rating-btn" data-value="3">3</button>
                                <button class="rating-btn" data-value="4">4</button>
                                <button class="rating-btn" data-value="5">5</button>
                            </div>
                        </div>
                        <div class="rating-group">
                            <div class="rating-label">Vocal Variety</div>
                            <div class="rating-buttons" data-rating="vocal">
                                <button class="rating-btn" data-value="1">1</button>
                                <button class="rating-btn" data-value="2">2</button>
                                <button class="rating-btn" data-value="3">3</button>
                                <button class="rating-btn" data-value="4">4</button>
                                <button class="rating-btn" data-value="5">5</button>
                            </div>
                        </div>
                    </div>

                    <div class="notes-section">
                        <div class="notes-label">One thing to improve:</div>
                        <textarea class="notes-textarea" id="practiceNotes" placeholder="What will you focus on tomorrow?"></textarea>
                    </div>

                    <button class="complete-btn" onclick="completeExercise()">Complete & Earn XP</button>
                </div>

                <!-- Progress Screen -->
                <div class="screen" id="progressScreen">
                    <div class="progress-header">
                        <h1 class="progress-title">Your Progress</h1>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">âš¡</div>
                            <div class="stat-value xp" id="statXp">0</div>
                            <div class="stat-label">Total XP</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ðŸ”¥</div>
                            <div class="stat-value streak" id="statStreak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ðŸŽ¯</div>
                            <div class="stat-value sessions" id="statSessions">0</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ðŸ‘‘</div>
                            <div class="stat-value level" id="statLevel">1</div>
                            <div class="stat-label">Level</div>
                        </div>
                    </div>

                    <div class="chart-section">
                        <h3 class="chart-title">This Week's Activity</h3>
                        <div class="chart-bars" id="weeklyChart"></div>
                    </div>

                    <div class="achievements-section">
                        <h3 class="chart-title">Achievements</h3>
                        <div class="achievements-grid" id="achievementsGrid"></div>
                    </div>

                    <div class="milestones-section">
                        <h3 class="chart-title">12-Week Milestones</h3>
                        <div id="milestonesContainer"></div>
                    </div>
                </div>

                <!-- Curriculum Screen -->
                <div class="screen" id="curriculumScreen">
                    <div class="curriculum-header">
                        <h1 class="curriculum-title">12-Week Plan</h1>
                    </div>
                    <div id="curriculumContainer"></div>
                </div>

                <!-- Library Screen -->
                <div class="screen" id="libraryScreen">
                    <div class="library-header">
                        <h1 class="library-title">Library</h1>
                    </div>
                    <div class="library-tabs" id="libraryTabs"></div>
                    <div id="libraryContent"></div>
                </div>
            </main>

            <nav class="nav">
                <div class="nav-inner">
                    <button class="nav-item active" data-screen="today">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                        <span>Today</span>
                    </button>
                    <button class="nav-item" data-screen="progress">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V5a2 2 0 00-2-2H6a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                        <span>Progress</span>
                    </button>
                    <button class="nav-item" data-screen="curriculum">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        <span>Plan</span>
                    </button>
                    <button class="nav-item" data-screen="library">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                        <span>Library</span>
                    </button>
                </div>
            </nav>
        </div>

        <!-- XP Popup -->
        <div class="xp-popup-overlay" id="xpPopupOverlay"></div>
        <div class="xp-popup" id="xpPopup">
            <div class="xp-popup-icon">ðŸŽ‰</div>
            <div class="xp-popup-title">Exercise Complete!</div>
            <div class="xp-popup-xp" id="xpPopupAmount">+50 XP</div>
            <div class="xp-popup-label" id="xpPopupLabel">Keep up the great work!</div>
            <button class="xp-popup-btn" onclick="closeXpPopup()">Continue</button>
        </div>

        <!-- Modal -->
        <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalTitle">Title</h2>
                    <button class="modal-close" onclick="closeModal()">Ã—</button>
                </div>
                <div class="modal-body" id="modalBody"></div>
            </div>
        </div>
    </div>

    <script>
        // ===== DATA =====
        const curriculum = {
            phases: [
                {
                    name: "Foundation + Interview Ready",
                    color: "phase1",
                    weeks: [1, 2, 3, 4],
                    weekDetails: [
                        { week: 1, focus: "Core Structures & Think Fast" },
                        { week: 2, focus: "Eliminating Fillers & Rambling" },
                        { week: 3, focus: "Behavioral Interview Mastery" },
                        { week: 4, focus: "Technical Explanations" }
                    ]
                },
                {
                    name: "Voice & Stakeholder Presence",
                    color: "phase2",
                    weeks: [5, 6, 7, 8],
                    weekDetails: [
                        { week: 5, focus: "The Vocal Instrument" },
                        { week: 6, focus: "Strategic Pausing" },
                        { week: 7, focus: "Cross-Functional Communication" },
                        { week: 8, focus: "Commanding Presence" }
                    ]
                },
                {
                    name: "Story & Influence",
                    color: "phase3",
                    weeks: [9, 10, 11, 12],
                    weekDetails: [
                        { week: 9, focus: "Finding Stories (Homework for Life)" },
                        { week: 10, focus: "Crafting Signature Stories" },
                        { week: 11, focus: "Self-Advocacy & Impact" },
                        { week: 12, focus: "Full Integration" }
                    ]
                }
            ]
        };

        const frameworks = {
            wsw: { name: "What? So What? Now What?", structure: "State fact â†’ Why it matters â†’ Action", icon: "ðŸ“" },
            psb: { name: "Problem â†’ Solution â†’ Benefit", structure: "Hook with problem â†’ Your solution â†’ The value", icon: "ðŸ’¡" },
            prep: { name: "PREP", structure: "Point â†’ Reason â†’ Example â†’ Point", icon: "ðŸŽ¯" },
            star: { name: "STAR + So What", structure: "Situation â†’ Task â†’ Action â†’ Result â†’ Impact", icon: "â­" },
            technical: { name: "Technical Explanation", structure: "Context â†’ Approach â†’ Trade-offs â†’ Outcome", icon: "ðŸ”§" }
        };

        const prompts = {
            impromptu: [
                "Your manager asks: 'What's the status of your biggest project?'",
                "A VP stops you: 'What's the most interesting thing you're working on?'",
                "Someone challenges: 'Why did you choose this approach over alternatives?'",
                "You're asked: 'What's the biggest risk we should be thinking about?'",
                "A stakeholder asks: 'Can you explain this metric to me?'",
                "You're put on the spot: 'What should we prioritize next quarter?'",
                "Someone asks: 'Why should we invest resources in this?'",
                "A director asks: 'What's one thing we could do better as a team?'"
            ],
            interview: [
                "Tell me about a time you had to influence without authority.",
                "Describe a project where you had to make a difficult trade-off.",
                "Tell me about a time you failed and what you learned.",
                "Describe how you've handled disagreement with a stakeholder.",
                "Tell me about your most impactful project in the last year.",
                "Describe a time you had to learn something quickly to deliver.",
                "Tell me about a time you improved a process or system.",
                "How do you prioritize when everything seems urgent?",
                "Tell me about a time you had to deliver difficult feedback.",
                "Why are you interested in switching teams?",
                "What would your skip-level say is your biggest growth area?",
                "Describe a time you had to make a decision with incomplete data.",
                "Tell me about navigating ambiguity on a cross-functional project.",
                "How have you built relationships with partner teams?",
                "Describe your approach to defining success metrics for a new feature."
            ],
            presentation: [
                "Present your last project's key findings in 2 minutes.",
                "Explain a complex technical concept to a non-technical audience.",
                "Pitch a new feature idea to leadership.",
                "Walk through a technical architecture decision you made.",
                "Present a recommendation with supporting data."
            ],
            oneOnOne: [
                "Articulate your career goals for the next 2 years.",
                "Make the case for why you deserve a promotion.",
                "Share feedback about something that could be better.",
                "Advocate for more resources for your project.",
                "Quantify and share a recent win."
            ],
            metaInterview: [
                "Tell me about a time you used data to influence a product decision.",
                "Describe how you've partnered with engineering on a metrics project.",
                "Walk me through how you'd approach measuring the success of a new feature.",
                "Tell me about a time your analysis changed the direction of a project.",
                "How do you handle stakeholders who disagree with your data findings?",
                "Describe a time you had to explain complex analysis to non-technical partners.",
                "Tell me about building a dashboard or metric that drove real impact.",
                "How do you prioritize multiple analysis requests from different teams?",
                "Describe your approach when you find data quality issues.",
                "Tell me about a growth experiment you designed and analyzed.",
                "How would you measure the impact of a social feature like linking?",
                "Describe a time you identified an insight that wasn't obvious from surface metrics.",
                "Tell me about working with ML engineers on a data science project.",
                "How do you communicate uncertainty in your analysis?",
                "Describe a time you had to push back on a stakeholder's interpretation of data."
            ]
        };

        const warmups = [
            { name: "Box Breathing", duration: "2 min", icon: "ðŸŒ¬ï¸", instructions: "Breathe in 4 counts, hold 4, out 4, hold 4. Repeat 5 times." },
            { name: "Articulation Drill", duration: "3 min", icon: "ðŸ‘…", instructions: "'Red leather, yellow leather' (x5), 'Unique New York' (x5)" },
            { name: "Projection Practice", duration: "2 min", icon: "ðŸ“¢", instructions: "Say your name at 3 volumes: conversational, across-room, crowd." },
            { name: "Pace Control", duration: "3 min", icon: "â±ï¸", instructions: "Read a paragraph at very slow, normal, and fast speeds." },
            { name: "Resonance & Tone", duration: "2 min", icon: "ðŸŽµ", instructions: "Hum for 30 seconds, then speak maintaining chest resonance." }
        ];

        const techniques = [
            { name: "The Power of the Pause", icon: "â¸ï¸", desc: "Strategic silence before key points creates anticipation." },
            { name: "Homework for Life", icon: "ðŸ““", desc: "Each night, identify the most story-worthy moment of your day." },
            { name: "The 5-Second Moment", icon: "âš¡", desc: "Every great story has a moment of transformation." },
            { name: "Yes-And Thinking", icon: "ðŸŽ­", desc: "Accept what's given and build on it." },
            { name: "Curse of Knowledge Antidote", icon: "ðŸ§ ", desc: "Start with what they know, use analogies." },
            { name: "Vocal Variety", icon: "ðŸŽ¤", desc: "Vary pace, pitch, and volume for impact." },
            { name: "Audience-Outcome-Material", icon: "ðŸŽ¯", desc: "Before speaking: Who? What outcome? What supports it?" }
        ];

        const achievements = [
            { id: "first_session", name: "First Step", icon: "ðŸ‘£", desc: "Complete your first exercise", xpReq: 0 },
            { id: "streak_3", name: "On Fire", icon: "ðŸ”¥", desc: "3 day streak", xpReq: 0 },
            { id: "streak_7", name: "Week Warrior", icon: "âš”ï¸", desc: "7 day streak", xpReq: 0 },
            { id: "streak_30", name: "Unstoppable", icon: "ðŸ†", desc: "30 day streak", xpReq: 0 },
            { id: "xp_500", name: "Rising Star", icon: "â­", desc: "Earn 500 XP", xpReq: 500 },
            { id: "xp_2000", name: "Speaker", icon: "ðŸŽ¤", desc: "Earn 2000 XP", xpReq: 2000 },
            { id: "xp_5000", name: "Presenter", icon: "ðŸŽ¯", desc: "Earn 5000 XP", xpReq: 5000 },
            { id: "xp_10000", name: "Master", icon: "ðŸ‘‘", desc: "Earn 10000 XP", xpReq: 10000 }
        ];

        const milestones = [
            { week: 2, text: "Structure a 60-second response within 5 seconds of any question" },
            { week: 4, text: "Deliver compelling STAR stories with zero filler words" },
            { week: 6, text: "Naturally vary pace/pitch/volume and use strategic pauses" },
            { week: 8, text: "Explain technical concepts to anyone in under 2 minutes" },
            { week: 10, text: "Have 5 signature stories ready to deploy anytime" },
            { week: 12, text: "Handle any speaking situation with full confidence" }
        ];

        const XP_VALUES = {
            warmup: 30,
            core: 50,
            reflection: 20,
            challenge: 100,
            dailyBonus: 50,
            streakBonus: 25
        };

        // ===== STATE =====
        let state = {
            started: false,
            currentWeek: 1,
            currentDay: 1,
            streak: 0,
            longestStreak: 0,
            lastPracticeDate: null,
            xp: 0,
            level: 1,
            sessions: [],
            todayCompleted: [],
            achievements: [],
            currentExercise: null,
            notificationsEnabled: false,
            recording: {
                isRecording: false,
                mediaRecorder: null,
                audioChunks: [],
                audioBlob: null,
                audioUrl: null
            },
            transcription: {
                recognition: null,
                transcript: "",
                isListening: false
            },
            timer: {
                seconds: 0,
                interval: null
            },
            fillerCounts: { um: 0, uh: 0, like: 0, so: 0 },
            ratings: { structure: 0, confidence: 0, vocal: 0 }
        };

        // ===== STORAGE =====
        function saveState() {
            const toSave = {
                started: state.started,
                currentWeek: state.currentWeek,
                currentDay: state.currentDay,
                streak: state.streak,
                longestStreak: state.longestStreak,
                lastPracticeDate: state.lastPracticeDate,
                xp: state.xp,
                level: state.level,
                sessions: state.sessions.slice(-100),
                todayCompleted: state.todayCompleted,
                achievements: state.achievements,
                notificationsEnabled: state.notificationsEnabled
            };
            localStorage.setItem('speakSharpState', JSON.stringify(toSave));
        }

        function loadState() {
            const saved = localStorage.getItem('speakSharpState');
            if (saved) {
                const parsed = JSON.parse(saved);
                Object.assign(state, parsed);
                checkStreak();
                checkDayReset();
            }
        }

        function checkStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            if (state.lastPracticeDate === today) {
                // Already practiced today
            } else if (state.lastPracticeDate === yesterday) {
                // Streak continues when they practice today
            } else if (state.lastPracticeDate && state.lastPracticeDate !== today) {
                // Missed a day
                state.streak = 0;
            }
        }

        function checkDayReset() {
            const today = new Date().toDateString();
            const lastDate = state.lastPracticeDate ? new Date(state.lastPracticeDate).toDateString() : null;
            
            if (lastDate !== today) {
                state.todayCompleted = [];
            }
        }

        function exportData() {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `speaksharp-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    Object.assign(state, imported);
                    saveState();
                    renderApp();
                    alert('Data imported successfully!');
                } catch (err) {
                    alert('Invalid backup file');
                }
            };
            reader.readAsText(file);
        }

        // ===== LEVEL SYSTEM =====
        function calculateLevel(xp) {
            // Each level requires more XP: 100, 250, 500, 800, 1200, 1700, 2300, 3000...
            const levels = [0, 100, 250, 500, 800, 1200, 1700, 2300, 3000, 4000, 5500, 7500, 10000];
            for (let i = levels.length - 1; i >= 0; i--) {
                if (xp >= levels[i]) return i + 1;
            }
            return 1;
        }

        function addXp(amount) {
            const oldLevel = state.level;
            state.xp += amount;
            state.level = calculateLevel(state.xp);
            
            if (state.level > oldLevel) {
                // Level up animation could go here
            }
            
            checkXpAchievements();
            saveState();
        }

        // ===== ACHIEVEMENTS =====
        function checkAchievements() {
            const newAchievements = [];
            
            if (!state.achievements.includes('first_session') && state.sessions.length > 0) {
                state.achievements.push('first_session');
                newAchievements.push(achievements.find(a => a.id === 'first_session'));
            }
            
            if (!state.achievements.includes('streak_3') && state.streak >= 3) {
                state.achievements.push('streak_3');
                newAchievements.push(achievements.find(a => a.id === 'streak_3'));
            }
            
            if (!state.achievements.includes('streak_7') && state.streak >= 7) {
                state.achievements.push('streak_7');
                newAchievements.push(achievements.find(a => a.id === 'streak_7'));
            }
            
            if (!state.achievements.includes('streak_30') && state.streak >= 30) {
                state.achievements.push('streak_30');
                newAchievements.push(achievements.find(a => a.id === 'streak_30'));
            }
            
            checkXpAchievements();
            
            if (newAchievements.length > 0) {
                showAchievementBanner(newAchievements[0]);
            }
        }

        function checkXpAchievements() {
            const xpAchievements = ['xp_500', 'xp_2000', 'xp_5000', 'xp_10000'];
            const xpThresholds = [500, 2000, 5000, 10000];
            
            xpAchievements.forEach((id, i) => {
                if (!state.achievements.includes(id) && state.xp >= xpThresholds[i]) {
                    state.achievements.push(id);
                }
            });
        }

        function showAchievementBanner(achievement) {
            const banner = document.getElementById('achievementBanner');
            document.getElementById('achievementIcon').textContent = achievement.icon;
            document.getElementById('achievementTitle').textContent = achievement.name;
            document.getElementById('achievementDesc').textContent = achievement.desc;
            banner.style.display = 'flex';
        }

        // ===== INIT =====
        function init() {
            loadState();
            
            if (state.started) {
                document.getElementById('introScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                renderApp();
            }

            // Setup navigation
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    showScreen(btn.dataset.screen);
                });
            });

            // Setup rating buttons
            document.querySelectorAll('.rating-buttons').forEach(group => {
                group.querySelectorAll('.rating-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const ratingType = group.dataset.rating;
                        const value = parseInt(btn.dataset.value);
                        state.ratings[ratingType] = value;
                        
                        group.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                    });
                });
            });

            // Setup speech recognition if available
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                state.transcription.recognition = new SpeechRecognition();
                state.transcription.recognition.continuous = true;
                state.transcription.recognition.interimResults = true;
                
                state.transcription.recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = 0; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    state.transcription.transcript = transcript;
                    document.getElementById('transcriptionText').textContent = transcript;
                };

                state.transcription.recognition.onerror = (event) => {
                    console.log('Speech recognition error:', event.error);
                };
            }

            // Save state when user leaves page
            window.addEventListener('beforeunload', () => {
                saveState();
            });
        }

        function startApp() {
            state.started = true;
            state.currentWeek = 1;
            state.currentDay = 1;
            saveState();
            
            document.getElementById('introScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            renderApp();
            requestNotificationPermission();
        }

        function renderApp() {
            updateHeader();
            renderTodayScreen();
            renderProgressScreen();
            renderCurriculumScreen();
            renderLibraryScreen();
        }

        // ===== UI UPDATES =====
        function updateHeader() {
            document.getElementById('streakCount').textContent = state.streak;
            document.getElementById('xpCount').textContent = state.xp;
            document.getElementById('levelBadge').textContent = `Lv. ${state.level}`;
        }

        function renderTodayScreen() {
            // Daily goal ring
            const completed = state.todayCompleted.length;
            const total = 3;
            const progress = (completed / total) * 213.6;
            document.getElementById('goalRingProgress').style.strokeDashoffset = 213.6 - progress;
            document.getElementById('goalValue').textContent = `${completed}/${total}`;
            
            if (completed >= total) {
                document.getElementById('goalTitle').textContent = 'ðŸŽ‰ Daily goal complete!';
                document.getElementById('goalSubtitle').textContent = 'Amazing work today!';
            } else {
                document.getElementById('goalTitle').textContent = `Complete ${total - completed} more`;
                document.getElementById('goalSubtitle').textContent = `+${XP_VALUES.dailyBonus} XP bonus for all 3`;
            }

            // Week progress
            const weekProgress = ((state.currentDay - 1) / 7) * 100;
            document.getElementById('weekLabel').textContent = `Week ${state.currentWeek}`;
            document.getElementById('weekPhase').textContent = getPhaseForWeek(state.currentWeek);
            document.getElementById('weekBarFill').style.width = `${weekProgress}%`;
            
            // Week days
            const daysContainer = document.getElementById('weekDays');
            const dayLabels = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
            daysContainer.innerHTML = dayLabels.map((label, i) => {
                const dayNum = i + 1;
                let classes = 'week-day';
                if (dayNum < state.currentDay) classes += ' completed';
                if (dayNum === state.currentDay) classes += ' today';
                return `<div class="${classes}">${dayNum < state.currentDay ? 'âœ“' : label}</div>`;
            }).join('');

            // Exercises
            renderTodayExercises();
        }

        function getPhaseForWeek(week) {
            if (week <= 4) return 'Interview Ready';
            if (week <= 8) return 'Voice & Presence';
            return 'Story & Influence';
        }

        function renderTodayExercises() {
            const container = document.getElementById('todayExercises');
            const week = state.currentWeek;
            
            const exercises = [
                {
                    id: 'warmup',
                    type: 'Warm-up',
                    name: warmups[(week - 1) % warmups.length].name,
                    duration: warmups[(week - 1) % warmups.length].duration,
                    xp: XP_VALUES.warmup,
                    iconClass: 'warmup',
                    icon: warmups[(week - 1) % warmups.length].icon
                },
                {
                    id: 'core',
                    type: 'Core Practice',
                    name: getCoreName(week),
                    duration: '15-20 min',
                    xp: XP_VALUES.core,
                    iconClass: 'core',
                    icon: 'ðŸŽ¯'
                },
                {
                    id: 'reflection',
                    type: 'Daily Log',
                    name: 'Reflection & Rating',
                    duration: '5 min',
                    xp: XP_VALUES.reflection,
                    iconClass: 'reflection',
                    icon: 'ðŸ“'
                }
            ];
            
            // Add weekly challenge on day 7
            if (state.currentDay === 7) {
                exercises.push({
                    id: 'challenge',
                    type: 'Weekly Challenge',
                    name: 'Milestone Test',
                    duration: '10 min',
                    xp: XP_VALUES.challenge,
                    iconClass: 'challenge',
                    icon: 'ðŸ†'
                });
            }
            
            container.innerHTML = exercises.map(ex => {
                const completed = state.todayCompleted.includes(ex.id);
                const locked = ex.id !== 'warmup' && !state.todayCompleted.includes('warmup') && !completed;
                
                return `
                    <div class="exercise-card ${completed ? 'completed' : ''} ${locked ? 'locked' : ''}" 
                         onclick="${locked ? '' : `startExercise('${ex.id}')`}">
                        <div class="exercise-icon ${ex.iconClass}">${ex.icon}</div>
                        <div class="exercise-content">
                            <div class="exercise-type">${ex.type}</div>
                            <div class="exercise-name">${ex.name}</div>
                            <div class="exercise-meta">
                                <span>${ex.duration}</span>
                                <span class="exercise-xp">+${ex.xp} XP</span>
                            </div>
                        </div>
                        <div class="exercise-check">${completed ? 'âœ“' : ''}</div>
                    </div>
                `;
            }).join('');
        }

        function getCoreName(week) {
            const names = {
                1: 'Structure Drills', 2: 'Think Fast, No Fillers',
                3: 'Behavioral Questions', 4: 'Technical Explanations',
                5: 'Vocal Variety', 6: 'The Power of Pause',
                7: 'Cross-Functional Comm', 8: 'Commanding Presence',
                9: 'Story Mining', 10: 'Story Crafting',
                11: 'Self-Advocacy', 12: 'Integration'
            };
            return names[week] || 'Practice';
        }

        // ===== PRACTICE =====
        function startExercise(id) {
            const week = state.currentWeek;
            let promptType = 'impromptu';
            let framework = 'wsw';
            let xp = XP_VALUES.core;
            
            if (id === 'warmup') {
                xp = XP_VALUES.warmup;
            } else if (id === 'reflection') {
                xp = XP_VALUES.reflection;
            } else if (id === 'challenge') {
                xp = XP_VALUES.challenge;
            } else {
                // Core exercise - determine prompt type based on week
                if (week <= 2) {
                    promptType = 'impromptu';
                    framework = week === 1 ? 'wsw' : 'prep';
                } else if (week <= 4) {
                    promptType = Math.random() > 0.3 ? 'metaInterview' : 'interview';
                    framework = week === 3 ? 'star' : 'technical';
                } else if (week <= 6) {
                    promptType = 'presentation';
                    framework = 'psb';
                } else if (week <= 8) {
                    promptType = 'presentation';
                    framework = 'technical';
                } else if (week <= 10) {
                    promptType = 'oneOnOne';
                    framework = 'star';
                } else {
                    promptType = ['impromptu', 'interview', 'metaInterview'][Math.floor(Math.random() * 3)];
                    framework = ['wsw', 'psb', 'star', 'prep'][Math.floor(Math.random() * 4)];
                }
            }
            
            state.currentExercise = { id, promptType, framework, xp };
            resetExerciseState();
            
            // Setup UI
            document.getElementById('practiceXp').textContent = xp;
            document.getElementById('practiceTitle').textContent = id === 'warmup' ? warmups[(week-1) % warmups.length].name : 
                id === 'reflection' ? 'Daily Reflection' : 
                id === 'challenge' ? 'Weekly Challenge' : getCoreName(week);
            document.getElementById('practiceSubtitle').textContent = id === 'warmup' ? 'Prepare your voice' :
                id === 'reflection' ? 'Review and plan ahead' :
                id === 'challenge' ? 'Test your progress' : 'Practice makes permanent';
            
            if (id === 'warmup') {
                const warmup = warmups[(week-1) % warmups.length];
                document.getElementById('promptText').textContent = warmup.instructions;
                document.getElementById('frameworkCard').style.display = 'none';
            } else if (id === 'reflection') {
                document.getElementById('promptText').textContent = "What went well today? What's one specific thing you'll focus on improving tomorrow?";
                document.getElementById('frameworkCard').style.display = 'none';
            } else {
                newPrompt();
                const fw = frameworks[framework];
                document.getElementById('frameworkCard').style.display = 'block';
                document.getElementById('frameworkName').textContent = fw.name;
                document.getElementById('frameworkStructure').textContent = fw.structure;
            }
            
            showScreen('practice');
            document.querySelector('.nav').style.display = 'none';
        }

        function resetExerciseState() {
            cleanupAudioPlayer();
            state.fillerCounts = { um: 0, uh: 0, like: 0, so: 0 };
            state.ratings = { structure: 0, confidence: 0, vocal: 0 };
            state.timer.seconds = 0;
            state.transcription.transcript = '';
            state.recording.audioBlob = null;
            
            document.querySelectorAll('.filler-count').forEach(el => el.textContent = '0');
            document.getElementById('fillerTotal').textContent = '0';
            document.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('practiceNotes').value = '';
            document.getElementById('timerDisplay').textContent = '0:00';
            document.getElementById('playbackSection').classList.remove('has-recording');
            document.getElementById('transcriptionSection').classList.remove('visible');
            document.getElementById('transcriptionText').textContent = '';
            document.getElementById('aiFeedbackSection').classList.remove('visible');
            document.getElementById('aiScore').style.display = 'none';
            document.getElementById('aiFeedbackContent').innerHTML = '';
        }

        function newPrompt() {
            const promptList = prompts[state.currentExercise.promptType] || prompts.impromptu;
            const randomPrompt = promptList[Math.floor(Math.random() * promptList.length)];
            document.getElementById('promptText').textContent = randomPrompt;
        }

        function exitPractice() {
            stopTimer();
            stopRecording();
            cleanupAudioPlayer();
            document.querySelector('.nav').style.display = 'block';
            showScreen('today');
        }

        function cleanupAudioPlayer() {
            if (window.audioPlayer) {
                window.audioPlayer.pause();
                window.audioPlayer = null;
            }
            if (state.recording.audioUrl) {
                URL.revokeObjectURL(state.recording.audioUrl);
                state.recording.audioUrl = null;
            }
        }

        // ===== RECORDING =====
        async function toggleRecording() {
            if (state.recording.isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                state.recording.mediaRecorder = new MediaRecorder(stream);
                state.recording.audioChunks = [];
                
                state.recording.mediaRecorder.ondataavailable = (e) => {
                    state.recording.audioChunks.push(e.data);
                };
                
                state.recording.mediaRecorder.onstop = () => {
                    state.recording.audioBlob = new Blob(state.recording.audioChunks, { type: 'audio/webm' });
                    state.recording.audioUrl = URL.createObjectURL(state.recording.audioBlob);
                    document.getElementById('playbackSection').classList.add('has-recording');
                    renderWaveform();
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Trigger AI feedback
                    if (state.transcription.transcript.length > 20) {
                        getAiFeedback();
                    }
                };
                
                state.recording.mediaRecorder.start();
                state.recording.isRecording = true;
                
                // Start speech recognition
                if (state.transcription.recognition) {
                    state.transcription.transcript = '';
                    document.getElementById('transcriptionSection').classList.add('visible');
                    document.getElementById('transcriptionStatus').textContent = 'Listening...';
                    try {
                        state.transcription.recognition.start();
                        state.transcription.isListening = true;
                    } catch (e) {
                        console.log('Speech recognition already started');
                    }
                }
                
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordIcon').innerHTML = '<rect x="6" y="6" width="12" height="12" rx="2"/>';
                document.getElementById('recordHint').textContent = 'Tap to stop';
                
                startTimer();
            } catch (err) {
                console.error('Recording error:', err);
                alert('Could not access microphone. Please allow microphone access and try again.');
            }
        }

        function stopRecording() {
            if (state.recording.mediaRecorder && state.recording.isRecording) {
                state.recording.mediaRecorder.stop();
                state.recording.isRecording = false;
                
                // Stop speech recognition
                if (state.transcription.recognition && state.transcription.isListening) {
                    state.transcription.recognition.stop();
                    state.transcription.isListening = false;
                    document.getElementById('transcriptionStatus').textContent = 'Complete';
                }
                
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordIcon').innerHTML = '<circle cx="12" cy="12" r="6"/>';
                document.getElementById('recordHint').textContent = 'Tap to record again';
                
                stopTimer();
            }
        }

        function renderWaveform() {
            const container = document.getElementById('waveform');
            const bars = 25;
            container.innerHTML = Array(bars).fill(0).map(() => {
                const height = Math.random() * 28 + 8;
                return `<div class="waveform-bar" style="height: ${height}px;"></div>`;
            }).join('');
        }

        function togglePlayback() {
            if (!state.recording.audioUrl) return;

            if (!window.audioPlayer) {
                window.audioPlayer = new Audio(state.recording.audioUrl);
                window.audioPlayer.onended = () => {
                    document.getElementById('playIcon').innerHTML = '<polygon points="5,3 19,12 5,21"/>';
                };
                window.audioPlayer.ontimeupdate = () => {
                    const time = Math.floor(window.audioPlayer.currentTime);
                    document.getElementById('playbackTime').textContent = formatTime(time);
                };
                window.audioPlayer.onerror = () => {
                    console.error('Audio playback error');
                    document.getElementById('playIcon').innerHTML = '<polygon points="5,3 19,12 5,21"/>';
                    window.audioPlayer = null;
                };
            }

            if (window.audioPlayer.paused) {
                window.audioPlayer.play().catch(err => {
                    console.error('Failed to play audio:', err);
                    document.getElementById('playIcon').innerHTML = '<polygon points="5,3 19,12 5,21"/>';
                });
                document.getElementById('playIcon').innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
            } else {
                window.audioPlayer.pause();
                document.getElementById('playIcon').innerHTML = '<polygon points="5,3 19,12 5,21"/>';
            }
        }

        // ===== AI FEEDBACK =====
        async function getAiFeedback() {
            const transcript = state.transcription.transcript;
            if (!transcript || transcript.length < 20) return;
            
            const feedbackSection = document.getElementById('aiFeedbackSection');
            feedbackSection.classList.add('visible');
            document.getElementById('aiLoading').style.display = 'flex';
            document.getElementById('aiScore').style.display = 'none';
            document.getElementById('aiFeedbackContent').innerHTML = '';
            
            const promptText = document.getElementById('promptText').textContent;
            const framework = state.currentExercise.framework;
            const fw = frameworks[framework];
            
            try {
                // Build the prompt for the AI
                const aiPrompt = `You are a speaking coach reviewing a practice response. Be encouraging but specific.

PROMPT GIVEN: "${promptText}"

SUGGESTED FRAMEWORK: ${fw ? fw.name + ' (' + fw.structure + ')' : 'None'}

SPEAKER'S RESPONSE (transcribed):
"${transcript}"

Please provide feedback in this exact JSON format (no markdown, just JSON):
{
  "scores": {
    "structure": <1-5>,
    "clarity": <1-5>,
    "conciseness": <1-5>
  },
  "strengths": ["<strength 1>", "<strength 2>"],
  "improvements": ["<specific actionable suggestion 1>", "<specific actionable suggestion 2>"],
  "fillerWordsDetected": <estimated count of um, uh, like, so>,
  "frameworkUsage": "<brief note on how well they used the suggested framework>",
  "oneThingToFocus": "<single most important thing to work on next>"
}`;

                // Call our Cloudflare Function (proxies to Gemini API)
                const response = await fetch('/api/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: aiPrompt })
                });

                const data = await response.json();
                const text = data.text || '';
                
                // Parse JSON response
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const feedback = JSON.parse(jsonMatch[0]);
                    displayAiFeedback(feedback);
                } else {
                    document.getElementById('aiFeedbackContent').innerHTML = `<p>${text}</p>`;
                }
            } catch (err) {
                console.error('AI feedback error:', err);
                document.getElementById('aiFeedbackContent').innerHTML = '<p>Could not get AI feedback. Check your connection or try again.</p>';
            }
            
            document.getElementById('aiLoading').style.display = 'none';
        }

        function displayAiFeedback(feedback) {
            document.getElementById('aiScore').style.display = 'flex';
            document.getElementById('aiStructureScore').textContent = feedback.scores?.structure || '-';
            document.getElementById('aiClarityScore').textContent = feedback.scores?.clarity || '-';
            document.getElementById('aiConcisenessScore').textContent = feedback.scores?.conciseness || '-';
            
            let html = '';
            
            if (feedback.strengths?.length) {
                html += '<h4>ðŸ’ª Strengths</h4><ul>';
                feedback.strengths.forEach(s => html += `<li>${s}</li>`);
                html += '</ul>';
            }
            
            if (feedback.improvements?.length) {
                html += '<h4>ðŸŽ¯ To Improve</h4><ul>';
                feedback.improvements.forEach(s => html += `<li>${s}</li>`);
                html += '</ul>';
            }
            
            if (feedback.frameworkUsage) {
                html += `<h4>ðŸ“ Framework Usage</h4><p>${feedback.frameworkUsage}</p>`;
            }
            
            if (feedback.oneThingToFocus) {
                html += `<h4>âš¡ Focus Next Time</h4><p><strong>${feedback.oneThingToFocus}</strong></p>`;
            }
            
            if (feedback.fillerWordsDetected > 0) {
                html += `<p style="color: var(--warning); margin-top: 12px;">âš ï¸ Detected ~${feedback.fillerWordsDetected} filler words</p>`;
            }
            
            document.getElementById('aiFeedbackContent').innerHTML = html;
        }

        // ===== TIMER =====
        function startTimer() {
            state.timer.seconds = 0;
            state.timer.interval = setInterval(() => {
                state.timer.seconds++;
                document.getElementById('timerDisplay').textContent = formatTime(state.timer.seconds);
            }, 1000);
        }

        function stopTimer() {
            if (state.timer.interval) {
                clearInterval(state.timer.interval);
                state.timer.interval = null;
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // ===== FILLER COUNTER =====
        function countFiller(type) {
            state.fillerCounts[type]++;
            document.getElementById(type + 'Count').textContent = state.fillerCounts[type];
            const total = Object.values(state.fillerCounts).reduce((a, b) => a + b, 0);
            document.getElementById('fillerTotal').textContent = total;
        }

        // ===== COMPLETE EXERCISE =====
        function completeExercise() {
            const ex = state.currentExercise;
            let xpEarned = ex.xp;
            
            // Streak bonus
            const today = new Date().toDateString();
            if (state.lastPracticeDate !== today) {
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                if (state.lastPracticeDate === yesterday) {
                    state.streak++;
                    xpEarned += XP_VALUES.streakBonus;
                } else {
                    state.streak = 1;
                }
                state.lastPracticeDate = today;
            }
            
            if (state.streak > state.longestStreak) {
                state.longestStreak = state.streak;
            }
            
            // Daily completion bonus
            if (!state.todayCompleted.includes(ex.id)) {
                state.todayCompleted.push(ex.id);
            }
            
            if (state.todayCompleted.length === 3 && !state.todayCompleted.includes('dailyBonus')) {
                xpEarned += XP_VALUES.dailyBonus;
                state.todayCompleted.push('dailyBonus');
            }
            
            // Save session
            const session = {
                id: Date.now(),
                date: new Date().toISOString(),
                exerciseId: ex.id,
                duration: state.timer.seconds,
                transcript: state.transcription.transcript,
                fillerCounts: { ...state.fillerCounts },
                ratings: { ...state.ratings },
                notes: document.getElementById('practiceNotes').value,
                xpEarned,
                week: state.currentWeek
            };
            state.sessions.push(session);
            
            // Add XP
            addXp(xpEarned);
            
            // Progress day/week
            if (state.todayCompleted.length >= 3) {
                state.currentDay++;
                if (state.currentDay > 7) {
                    state.currentDay = 1;
                    state.currentWeek = Math.min(state.currentWeek + 1, 12);
                }
            }
            
            checkAchievements();
            saveState();
            
            // Show XP popup
            showXpPopup(xpEarned);

            // Cleanup
            cleanupAudioPlayer();
        }

        function showXpPopup(amount) {
            document.getElementById('xpPopupAmount').textContent = `+${amount} XP`;
            document.getElementById('xpPopupOverlay').classList.add('visible');
            document.getElementById('xpPopup').classList.add('visible');
        }

        function closeXpPopup() {
            document.getElementById('xpPopupOverlay').classList.remove('visible');
            document.getElementById('xpPopup').classList.remove('visible');
            document.querySelector('.nav').style.display = 'block';
            showScreen('today');
            renderApp();
        }

        // ===== PROGRESS SCREEN =====
        function renderProgressScreen() {
            document.getElementById('statXp').textContent = state.xp.toLocaleString();
            document.getElementById('statStreak').textContent = state.streak;
            document.getElementById('statSessions').textContent = state.sessions.length;
            document.getElementById('statLevel').textContent = state.level;
            
            renderWeeklyChart();
            renderAchievements();
            renderMilestones();
        }

        function renderWeeklyChart() {
            const container = document.getElementById('weeklyChart');
            const days = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
            
            const today = new Date();
            const dayOfWeek = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
            monday.setHours(0, 0, 0, 0);
            
            const weekSessions = days.map((_, i) => {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                const dateStr = date.toDateString();
                return state.sessions.filter(s => new Date(s.date).toDateString() === dateStr).length;
            });
            
            const maxSessions = Math.max(...weekSessions, 3);
            
            container.innerHTML = days.map((day, i) => {
                const height = weekSessions[i] > 0 ? Math.max((weekSessions[i] / maxSessions * 80), 10) : 8;
                const filled = weekSessions[i] > 0 ? 'filled' : '';
                return `
                    <div class="chart-bar-group">
                        <div class="chart-bar ${filled}" style="height: ${height}px;"></div>
                        <span class="chart-day">${day}</span>
                    </div>
                `;
            }).join('');
        }

        function renderAchievements() {
            const container = document.getElementById('achievementsGrid');
            container.innerHTML = achievements.map(a => {
                const unlocked = state.achievements.includes(a.id);
                return `
                    <div class="achievement-item ${unlocked ? 'unlocked' : 'locked'}">
                        <span class="achievement-emoji">${a.icon}</span>
                        <span class="achievement-name">${a.name}</span>
                    </div>
                `;
            }).join('');
        }

        function renderMilestones() {
            const container = document.getElementById('milestonesContainer');
            container.innerHTML = milestones.map(m => {
                const achieved = state.currentWeek > m.week;
                return `
                    <div class="milestone-card ${achieved ? 'achieved' : ''}">
                        <div class="milestone-check">${achieved ? 'âœ“' : ''}</div>
                        <div class="milestone-content">
                            <div class="milestone-week">Week ${m.week}</div>
                            <div class="milestone-text">${m.text}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== CURRICULUM SCREEN =====
        function renderCurriculumScreen() {
            const container = document.getElementById('curriculumContainer');
            container.innerHTML = curriculum.phases.map((phase, i) => {
                const isCurrent = phase.weeks.includes(state.currentWeek);
                return `
                    <div class="phase-card ${isCurrent ? 'current expanded' : ''}" onclick="this.classList.toggle('expanded')">
                        <div class="phase-header">
                            <div class="phase-header-left">
                                <span class="phase-badge ${phase.color}">Phase ${i + 1}</span>
                                <div class="phase-name">${phase.name}</div>
                                <div class="phase-weeks">Weeks ${phase.weeks[0]}-${phase.weeks[phase.weeks.length - 1]}</div>
                            </div>
                            <span class="phase-toggle">â–¼</span>
                        </div>
                        <div class="phase-content">
                            ${phase.weekDetails.map(w => {
                                const status = w.week < state.currentWeek ? 'completed' : w.week === state.currentWeek ? 'current' : '';
                                return `
                                    <div class="week-item ${status}">
                                        <div class="week-status">${w.week < state.currentWeek ? 'âœ“' : ''}</div>
                                        <div class="week-info">
                                            <div class="week-number">Week ${w.week}</div>
                                            <div class="week-focus">${w.focus}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== LIBRARY SCREEN =====
        function renderLibraryScreen() {
            const tabs = ['Frameworks', 'Warm-ups', 'Techniques'];
            document.getElementById('libraryTabs').innerHTML = tabs.map((tab, i) => 
                `<button class="library-tab ${i === 0 ? 'active' : ''}" onclick="switchLibraryTab('${tab.toLowerCase()}', this)">${tab}</button>`
            ).join('');
            
            renderLibraryContent('frameworks');
        }

        function switchLibraryTab(tab, btn) {
            document.querySelectorAll('.library-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            renderLibraryContent(tab);
        }

        function renderLibraryContent(tab) {
            const container = document.getElementById('libraryContent');
            let items = [];
            let iconClass = '';
            
            if (tab === 'frameworks') {
                items = Object.values(frameworks).map(f => ({ ...f, desc: f.structure }));
                iconClass = 'framework';
            } else if (tab === 'warm-ups') {
                items = warmups.map(w => ({ name: w.name, icon: w.icon, desc: w.duration + ' - ' + w.instructions.substring(0, 50) + '...' }));
                iconClass = 'warmup';
            } else {
                items = techniques;
                iconClass = 'technique';
            }
            
            container.innerHTML = items.map((item, i) => `
                <div class="library-item" onclick="showLibraryDetail('${tab}', ${i})">
                    <div class="library-item-icon ${iconClass}">${item.icon}</div>
                    <div class="library-item-content">
                        <div class="library-item-title">${item.name}</div>
                        <div class="library-item-desc">${item.desc}</div>
                    </div>
                </div>
            `).join('');
        }

        function showLibraryDetail(tab, index) {
            let item;
            if (tab === 'frameworks') item = Object.values(frameworks)[index];
            else if (tab === 'warm-ups') item = warmups[index];
            else item = techniques[index];
            
            document.getElementById('modalTitle').textContent = item.name;
            
            let body = '';
            if (item.structure) body += `<h3>Structure</h3><p>${item.structure}</p>`;
            if (item.duration) body += `<h3>Duration</h3><p>${item.duration}</p>`;
            if (item.instructions) body += `<h3>Instructions</h3><p>${item.instructions}</p>`;
            if (item.desc && tab === 'techniques') body += `<h3>Description</h3><p>${item.desc}</p>`;
            
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function showFrameworkHelp() {
            const fw = frameworks[state.currentExercise?.framework || 'wsw'];
            document.getElementById('modalTitle').textContent = fw.name;
            document.getElementById('modalBody').innerHTML = `
                <h3>Structure</h3>
                <p>${fw.structure}</p>
                <h3>How to Use</h3>
                <p>Start with the first element, then move through each part. Take a breath between sections.</p>
            `;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal(event) {
            if (!event || event.target === document.getElementById('modalOverlay')) {
                document.getElementById('modalOverlay').classList.remove('active');
            }
        }

        // ===== SETTINGS =====
        function openSettings() {
            document.getElementById('modalTitle').textContent = 'Settings';
            document.getElementById('modalBody').innerHTML = `
                <div class="settings-section">
                    <div class="settings-title">Data</div>
                    <div class="settings-item">
                        <div>
                            <div class="settings-item-label">Export Progress</div>
                            <div class="settings-item-desc">Download your data as backup</div>
                        </div>
                        <button class="settings-btn" onclick="exportData(); closeModal();">Export</button>
                    </div>
                    <div class="settings-item">
                        <div>
                            <div class="settings-item-label">Import Progress</div>
                            <div class="settings-item-desc">Restore from backup file</div>
                        </div>
                        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(this.files[0]); closeModal();">
                        <button class="settings-btn" onclick="document.getElementById('importFile').click()">Import</button>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">Notifications</div>
                    <div class="settings-item">
                        <div>
                            <div class="settings-item-label">Daily Reminders</div>
                            <div class="settings-item-desc">Get reminded to practice</div>
                        </div>
                        <div class="toggle-switch ${state.notificationsEnabled ? 'active' : ''}" onclick="toggleNotifications(this)"></div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">Progress</div>
                    <div class="settings-item">
                        <div>
                            <div class="settings-item-label">Current Week</div>
                            <div class="settings-item-desc">Week ${state.currentWeek} of 12</div>
                        </div>
                    </div>
                    <div class="settings-item">
                        <div>
                            <div class="settings-item-label">Total Sessions</div>
                            <div class="settings-item-desc">${state.sessions.length} completed</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function toggleNotifications(el) {
            el.classList.toggle('active');
            state.notificationsEnabled = el.classList.contains('active');
            saveState();
            
            if (state.notificationsEnabled) {
                requestNotificationPermission();
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // ===== NAVIGATION =====
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(screenName + 'Screen').classList.add('active');
            document.querySelector(`.nav-item[data-screen="${screenName}"]`)?.classList.add('active');
        }

        // ===== START =====
        init();
    </script>
</body>
</html>
